> 🇬🇧 English source: [docs/05_control_plane.md](../05_control_plane.md)

# שכבת הבקרה — מבוא טכני (HE)

## מטרה

שכבת הבקרה של HUB_Optimus היא תת‑מערכת חדשה המחברת את מסגרת הממשל והסימולציה לרשימת כלים ואוטומציה בעולם האמיתי. מטרתה לאכוף מדיניות, לתווך גישה לכלים, לרשום נתוני טלמטריה ולהבטיח שהאינטראקציות יישארו לא כפויות וניתנות לאימות.

## רכיבים

### מנוע מדיניות (PolicyEngine)

`PolicyEngine` מחזיק קבוצה של כללי הרשאה המגדירים איזה שחקנים יכולים להזמין אילו כלים. במתכונתו הפשוטה ביותר זהו מילון בזיכרון, אך בעתיד הוא נועד להיות מוחלף במנוע מדיניות רשמי (למשל Open Policy Agent).

### שכבת הבקרה (ControlPlane)

`ControlPlane` מתזמר קריאות לכלים. הוא מקבל בקשות משחקנים, מתייעץ עם `PolicyEngine` כדי להחליט אם הקריאה מותרת, מתעד את התוצאה ומחזיר את המידע. כלים נרשמים כקריאות פייתון ויכולים לנוע מפונקציות אריתמטיות פשוטות ועד שרתי MCP מלאים.

## אופן שימוש

1. ייבא את שכבת הבקרה:

   ```python
   from hub_optimus import ControlPlane, PolicyEngine
   ```

2. הגדר מילון מדיניות הממפה שחקנים לכלים מורשים וייצר מופע של `PolicyEngine`.

3. רשום כלים עם `register_tool(name, func)`.

4. הזמן כלים באמצעות `invoke(actor, tool_name, **params)`. שכבת הבקרה מחזירה רביעייה `(call_id, timestamp, result, error)` ורושמת את הקריאה ביומן.

לקבלת דוגמאות קונקרטיות, ראה את מבחני היחידה ב־`hub_optimus/test_hub_optimus_control.py`.

## מצב נוכחי ושלבים הבאים

שכבת הבקרה הזו היא אבטיפוס, והיא צריכה להיות מורחבת לשילוב:

- הערכת מדיניות רשמית (למשל OPA/Rego).
- זהות והרשאות דרך SPIFFE/SPIRE ו־OpenFGA.
- יכולת תצפית בעזרת OpenTelemetry.
- בידוד ההרצה של כלים (למשל קונטיינרים או microVMs).
- מחברי MCP לשירותים חיצוניים.

תרומות ותרגומים למסמך זה יתקבלו בברכה.
